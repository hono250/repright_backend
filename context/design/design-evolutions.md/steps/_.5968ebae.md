---
timestamp: 'Thu Oct 16 2025 19:41:44 GMT-0400 (Eastern Daylight Time)'
parent: '[[../20251016_194144.85bd2b26.md]]'
content_id: 5968ebae82b500497d07eaa723b504340226f29fe2405585352d487cc8122f9d
---

# Design Evolution from Assignment 2

## Overview

This document tracks significant changes made to the RepRight concept design based on  feedback and implementation discoveries.

## Concept Refinements

### 1. WorkoutLog: Added getSummary Action

**Rationale:** ProgressionGuidance was improperly dependent on WorkoutLog's internal state. Concepts cannot directly access each other's state - they can only pass data through action return values in syncs.

**Change:** Added `getSummary()` action that outputs structured workout data (recent sets, session count, dates) suitable for LLM analysis. This creates a clean interface between concepts.

**Impact:** ProgressionGuidance now receives all necessary data through the sync without coupling to WorkoutLog's implementation.

***

### 2. ProgressionGuidance: Added User Interaction Actions

**Rationale:** There was missing actions for accepting/dismissing recommendations. The original design generated recommendations but had no way for users to act on them.

**Changes Added:**

* `acceptRecommendation()` - marks recommendation as accepted, returns values for workout logging
* `dismissRecommendation()` - allows user to reject suggestion
* `getRecommendationHistory()` - lets users browse past suggestions
* Added `status` field to Recommendation state ("pending" | "accepted" | "dismissed")

**Impact:** Users can now interact with AI suggestions rather than just viewing them. Supports what's described in the user journeys.

***

### 3. ProgressionGuidance: Removed recentSets Parameter

**Rationale:** Original design had `generateRecommendation()` accepting `recentSets: set of WorkoutSet`, which would require passing WorkoutLog's internal state structure. This violates concept independence.

**Change:** Replaced with `workoutSummary: Object` parameter that accepts the structured output from WorkoutLog's `getSummary()` action.

**Impact:** Maintains concept modularity

***

### 4. UserAuthentication: Simplified for MVP

**Rationale:** For initial implementation, full session management with expiration is more complex than needed. Can iterate later.

**Change:** Kept session-based auth design but will implement with simpler token validation initially.

**Impact:** Allows focus on core fitness functionality while maintaining security basics.

***

## Missing Sync (TODO)

**Feedback:** Missing a sync that generates a recommendation (based on workout history) when the workout starts, and then if its accepted, that's what will be logged in workoutlog.

**TODO:** Implement this sync in Assignment 4b

The sync will:

1. When user starts workout → call WorkoutLog.getSummary()
2. Pass summary to ProgressionGuidance.generateRecommendationLLM()
3. If user accepts → use returned values in WorkoutLog.logSet()

***

## LLM Reliability Concerns

**Feedback:** Questions about LLm reliability on these tasks suggests plan for some fallbacks.

**Mitigation Strategies:**

1. **Validators** - Already implemented in A3: weight change limits, rep range checks, plateau-strategy consistency
2. **User control** - Accept/dismiss actions let users override bad suggestions
3. **Recommendation history** - Users can see all past suggestions to identify patterns of good/bad advice
4. **Multiple prompt variants** - Tested in A3, using Context-Aware variant that performs best
5. **Fallback UI** - If LLM fails, users can still manually log workouts without recommendations

***

## Interesting Moments Log

### 1. Argon2 → bcrypt Library Switch

**Issue:** Argon2 version 0.3.0 didn't exist, and 3.0.2 had native execution errors in `verify()` function.

**Solution:** Switched to bcrypt for password hashing - simpler and more stable for Deno environment.

**Link:** [20251016\_183647.05c4ffb6](../context/src/concepts/UserAuthentication/UserAuthenticationConcept.test.ts/20251016_183647.05c4ffb6.md)

### 2. Added getSummary() Action to WorkoutLog

**Rationale:** A2 feedback identified improper concept dependency - ProgressionGuidance was accessing WorkoutLog's internal state.

**Solution:** Created `getSummary()` action that returns structured data, maintaining concept independence.

**Link:**[20251016\_183153.e02d3181](../context/src/concepts/WorkoutLog/WorkoutLogConcept.ts/20251016_183153.e02d3181.md)

### 3. Mock LLM for Cost-Free Testing

**Challenge:** Testing ProgressionGuidance would consume API credits with every test run.

**Solution:** Created `MockLLM` class that returns predetermined responses, allowing full test coverage without API costs.

**Link:[20251016\_183357.a78e003f](../context/src/concepts/ProgressionGuidance/ProgressionGuidanceConcept.test.ts/20251016_183357.a78e003f.md)**

### 4. Ported A3 Validators Successfully

**Achievement:** All 3 validators from Assignment 3 (weight change limits, rep range checks, plateau-strategy consistency) integrated and tested with mock edge cases to verify they catch potential LLM hallucinations when real LLM is used.

**Link:** [20251016\_183337.d1761aac](../context/src/concepts/ProgressionGuidance/ProgressionGuidanceConcept.ts/20251016_183337.d1761aac.md)

### 5. MongoDB Connection Leaks in Deno Tests

**Discovery:** Tests showed resource leaks, but these were MongoDB driver internals, not the code. Switching to per-test database initialization resolved functional issues.

**Link:** [20251016\_183212.5be893de](../context/src/concepts/WorkoutLog/WorkoutLogConcept.test.ts/20251016_183212.5be893de.md)
